(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-strategy-execute-add"],{"01c6":function(e,t,a){"use strict";a.r(t);var n=a("1f18"),r=a("8332");for(var o in r)"default"!==o&&function(e){a.d(t,e,(function(){return r[e]}))}(o);a("5dad");var i,s=a("f0c5"),c=Object(s["a"])(r["default"],n["b"],n["c"],!1,null,"0214fcd7",null,!1,n["a"],i);t["default"]=c.exports},"01e7":function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return n}));var n={uniForms:a("52c4").default,uniFormsItem:a("1c7f").default,uniEasyinput:a("01c6").default},r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"uni-container"},[a("uni-forms",{ref:"form",on:{submit:function(t){arguments[0]=t=e.$handleEvent(t),e.submit.apply(void 0,arguments)}},model:{value:e.formData,callback:function(t){e.formData=t},expression:"formData"}},[a("uni-forms-item",{attrs:{name:"strategy_code",label:"选择策略"}},[a("v-uni-view",{staticClass:"strategy-picker-box"},[a("v-uni-picker",{attrs:{value:e.strategyIndex,range:e.strategyPicker},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.strategyPickerChange.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"picker"},[e._v(e._s(e.strategyIndex>-1?e.strategyPicker[e.strategyIndex]:"点击选择"))])],1)],1)],1),a("uni-forms-item",{attrs:{name:"data_batch",label:"数据批次"}},[a("v-uni-view",{staticClass:"strategy-picker-box"},[a("v-uni-picker",{staticClass:"strategy-picker",attrs:{value:e.batchIndex,range:e.batchPicker},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.batchPickerChange.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"picker"},[e._v(e._s(e.batchIndex>-1?e.batchPicker[e.batchIndex]:"点击选择"))])],1)],1)],1),a("uni-forms-item",{attrs:{name:"execute_batch",label:"执行批次"}},[a("uni-easyinput",{attrs:{clearable:!0,placeholder:"请输入批次"},model:{value:e.formData.execute_batch,callback:function(t){e.$set(e.formData,"execute_batch",t)},expression:"formData.execute_batch"}})],1),a("uni-forms-item",{attrs:{name:"",label:"执行进度"}},[a("v-uni-slider",{attrs:{value:e.executeProcess,"show-value":!0}})],1),a("v-uni-view",{staticClass:"uni-button-group"},[a("v-uni-button",{staticClass:"uni-button",staticStyle:{width:"100px"},attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.submitForm.apply(void 0,arguments)}}},[e._v(e._s(e.$t("common.button.submit")))]),a("v-uni-navigator",{staticStyle:{"margin-left":"15px"},attrs:{"open-type":"navigateBack"}},[a("v-uni-button",{staticClass:"uni-button",staticStyle:{width:"100px"}},[e._v(e._s(e.$t("common.button.back")))])],1)],1)],1)],1)},o=[]},"0baa":function(e,t,a){var n=a("24fb");t=n(!1),t.push([e.i,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.uni-easyinput[data-v-0214fcd7]{width:100%;flex:1;position:relative;text-align:left;color:#333;font-size:14px}.uni-easyinput__content[data-v-0214fcd7]{flex:1;width:100%;display:flex;box-sizing:border-box;min-height:36px;flex-direction:row;align-items:center}.uni-easyinput__content-input[data-v-0214fcd7]{width:auto;position:relative;overflow:hidden;flex:1;line-height:1;font-size:14px}.is-textarea[data-v-0214fcd7]{align-items:flex-start}.is-textarea-icon[data-v-0214fcd7]{margin-top:5px}.uni-easyinput__content-textarea[data-v-0214fcd7]{position:relative;overflow:hidden;flex:1;line-height:1.5;font-size:14px;padding-top:6px;padding-bottom:10px;height:80px;min-height:80px;width:auto}.input-padding[data-v-0214fcd7]{padding-left:10px}.content-clear-icon[data-v-0214fcd7]{padding:0 5px}.label-icon[data-v-0214fcd7]{margin-right:5px;margin-top:-1px}.is-input-border[data-v-0214fcd7]{display:flex;box-sizing:border-box;flex-direction:row;align-items:center;border:1px solid #c8c7cc;border-radius:4px}.is-required[data-v-0214fcd7]{color:#dd524d}.uni-error-message[data-v-0214fcd7]{position:absolute;bottom:-17px;left:0;line-height:12px;color:#dd524d;font-size:12px;text-align:left}.uni-error-msg--boeder[data-v-0214fcd7]{position:relative;bottom:0;line-height:22px}.is-input-error-border[data-v-0214fcd7]{border-color:#dd524d}.uni-easyinput--border[data-v-0214fcd7]{margin-bottom:0;padding:10px 15px;border-top:1px #eee solid}.uni-easyinput-error[data-v-0214fcd7]{padding-bottom:0}.is-first-border[data-v-0214fcd7]{border:none}.is-disabled[data-v-0214fcd7]{background-color:#eee}',""]),e.exports=t},1126:function(e,t,a){"use strict";(function(e){var n=a("4ea4");a("4160"),a("acd8"),a("e25e"),a("159b"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("96cf");var r=n(a("1da1")),o=e.database(),i=o.command,s={strategyDrop2:function(e,t){var a=this;return(0,r.default)(regeneratorRuntime.mark((function n(){var r,s,c,u,l,d,f,p,g,h,m,v,y;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return console.log("drop strategyDrop"),r={},c="",n.next=4,a.getStrategy();case 4:return r=n.sent,console.log("strategy:",r),s=parseInt(r.dropDay),console.log("dropDay:",s),c=a.getDropDateFrom(s),console.log("dropDateFrom:",c),u={},l=0,d=50,f=0,p={},g="",h=[],m=[],v=[],n.next=13,o.collection("stock-code").where({_id:i.neq(null)}).count();case 13:return u=n.sent,l=u.result.total,f=Math.ceil(l/d),n.next=18,o.collection("stock-code").limit(1).orderBy("_id","asc").get();case 18:u=n.sent,g=u.result.data[0]._id,console.log("totalCount:",l,"totalPage:",f,"lastId:",g),y=0;case 22:if(!(y<f)){n.next=40;break}return console.log("当前分页:",y),n.next=26,a.getStockCodeByPage(y,g,d);case 26:return p=n.sent,h=p.dataList,g=p.lastId,n.next=31,a.getHistoryData2(h,c);case 31:return m=n.sent,console.log("historyDataList:",m),v=a.getStrategyItems2(m,s),console.log("strategyItemList:",v),n.next=37,a.insertStrategyResult(v,e,t);case 37:y++,n.next=22;break;case 40:case"end":return n.stop()}}),n)})))()},strategyDrop:function(e,t){var a=this;return(0,r.default)(regeneratorRuntime.mark((function n(){var r,s,c,u,l,d,f,p,g,h,m;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return console.log("drop strategyDrop"),r={},n.next=4,a.getStrategy();case 4:return r=n.sent,console.log("strategy:",r),s=parseInt(r.dropDay),console.log("dropDay:",s),a.getDropDateFrom(s),c={},u=0,l=50,d=0,f={},p="",g=[],h=[],n.next=12,o.collection("stock-code").where({_id:i.neq(null)}).count();case 12:return c=n.sent,u=c.result.total,d=Math.ceil(u/l),n.next=17,o.collection("stock-code").limit(1).orderBy("_id","asc").get();case 17:c=n.sent,p=c.result.data[0]._id,console.log("totalCount:",u,"totalPage:",d,"lastId:",p),m=0;case 21:if(!(m<d)){n.next=37;break}return console.log("当前分页:",m),n.next=25,a.getStockCodeByPage(m,p,l);case 25:return f=n.sent,g=f.dataList,p=f.lastId,console.log("dataList:",g),n.next=31,a.getStrategyItems(g,s);case 31:return h=n.sent,n.next=34,a.insertStrategyResult(h,e,t);case 34:m++,n.next=21;break;case 37:case"end":return n.stop()}}),n)})))()},getStockCodeByPage:function(e,t,a){return(0,r.default)(regeneratorRuntime.mark((function n(){var r,s,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(console.log("drop getStockCodeByPage currentPageNo:",e),r={},s={},0!=e){n.next=9;break}return n.next=6,o.collection("stock-code").where({_id:i.gte(t)}).limit(a).orderBy("_id","asc").get();case 6:r=n.sent,n.next=12;break;case 9:return n.next=11,o.collection("stock-code").where({_id:i.gt(t)}).limit(a).orderBy("_id","asc").get();case 11:r=n.sent;case 12:return c=r.result.data.length,s.lastId=r.result.data[c-1]._id,s.dataList=r.result.data,n.abrupt("return",s);case 16:case"end":return n.stop()}}),n)})))()},getStrategyItems:function(e,t){return(0,r.default)(regeneratorRuntime.mark((function t(){var a,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for([],a=[],0,n="",r=0;r<e.length;r++)n=n+'"'+e[r].code+'",';return t.abrupt("return",a);case 3:case"end":return t.stop()}}),t)})))()},getHistoryData2:function(e,t){return(0,r.default)(regeneratorRuntime.mark((function a(){var n,r,i,s,c;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:for(n="",r="",i={},s=[],0,c=0;c<e.length;c++)n=n+'"'+e[c].code+'",';return n="code in ["+n.substr(0,n.length-1)+"]",r=n+' && date >= "'+t+'"',console.log("sqlWhere:",r),a.next=7,o.collection("stock-data-history").where(r).limit(500).orderBy("code","asc").get();case 7:return i=a.sent,s=i.result.data,a.abrupt("return",s);case 10:case"end":return a.stop()}}),a)})))()},getStrategyItems2:function(e,t){var a=e[0],n=0,r=[];return e.forEach((function(e,o){a.code==e.code?parseFloat(e.close)<parseFloat(e.open)&&(n+=1):(a=e,n=0),n==t&&r.push(a)})),r},insertStrategyResult:function(e,t,a){return(0,r.default)(regeneratorRuntime.mark((function n(){var r,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r={},i=[],{},e.forEach((function(e,n){r={},r.execute_batch=t,r.strategy_code="drop",r.stock_code=e.code,r.stock_name=e.name,r.stock_date=e.date,r.execute_time=a,i.push(r)})),n.next=4,o.collection("stock-strategy-result").add(i);case 4:n.sent;case 5:case"end":return n.stop()}}),n)})))()},getStrategy:function(){return(0,r.default)(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={},a={},e.next=3,o.collection("stock-strategy-set").where({code:"drop"}).orderBy("no","asc").get();case 3:return t=e.sent,a.dropDay=t.result.data[0].value,e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})))()},getHistoryData:function(e,t){return(0,r.default)(regeneratorRuntime.mark((function a(){var n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=[],r={},a.next=3,o.collection("stock-data-history").where({code:e}).limit(t).orderBy("date","desc").get();case 3:return r=a.sent,n=r.result.data,console.log("getHistoryData historyData:",n),a.abrupt("return",n);case 7:case"end":return a.stop()}}),a)})))()},getHistoryDataByPage:function(e,t,a){return(0,r.default)(regeneratorRuntime.mark((function n(){var r,s,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(console.log("drop getHistoryDataByPage currentPageNo:",e),r={},s={},0!=e){n.next=9;break}return n.next=6,o.collection("stock-data-history").where({_id:i.gte(t)}).limit(a).orderBy("_id","asc").get();case 6:r=n.sent,n.next=12;break;case 9:return n.next=11,o.collection("stock-data-history").where({_id:i.gt(t)}).limit(a).orderBy("_id","asc").get();case 11:r=n.sent;case 12:return c=r.result.data.length,s.lastId=r.result.data[c-1]._id,s.dataList=r.result.data,n.abrupt("return",s);case 16:case"end":return n.stop()}}),n)})))()},getDropDateFrom:function(e){var t,a,n,r,o,i,s,c=new Date,u=0;return a=c.getFullYear(),n=c.getMonth()+1,r=c.getDate(),n=n>9?n:"0"+n,r=r>9?r:"0"+r,c=a+"-"+n+"-"+r,c+=" 00:00:00",c=Date.parse(new Date(c))/1e3,u=this.getWeekenDayCount(e),e+=u,c-=86400*e,t=new Date(1e3*parseInt(c)),o=t.getFullYear(),i=t.getMonth()+1,s=t.getDate(),i=i>9?i:"0"+i,s=s>9?s:"0"+s,t=o+"-"+i+"-"+s,t},getWeekenDayCount:function(e){for(var t=0,a=0;a<e;a++){var n=new Date,r=void 0;n=n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate(),n+=" 00:00:00",n=Date.parse(new Date(n))/1e3,n-=86400*(a+1),r=new Date(1e3*parseInt(n)),r.getDay()in[0,6]&&(t+=1)}return t}};t.default=s}).call(this,a("a9ff")["default"])},"1e25":function(e,t,a){"use strict";var n=a("23e7"),r=a("58a8").end,o=a("c8d2"),i=o("trimEnd"),s=i?function(){return r(this)}:"".trimEnd;n({target:"String",proto:!0,forced:i},{trimEnd:s,trimRight:s})},"1f18":function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return n}));var n={uniIcons:a("48a2").default},r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"uni-easyinput",class:{"uni-easyinput-error":e.msg},style:{color:e.inputBorder&&e.msg?"#dd524d":e.styles.color}},[a("v-uni-view",{staticClass:"uni-easyinput__content",class:{"is-input-border":e.inputBorder,"is-input-error-border":e.inputBorder&&e.msg,"is-textarea":"textarea"===e.type,"is-disabled":e.disabled},style:{"border-color":e.inputBorder&&e.msg?"#dd524d":e.styles.borderColor,"background-color":e.disabled?e.styles.disableColor:""}},[e.prefixIcon?a("uni-icons",{staticClass:"content-clear-icon",attrs:{type:e.prefixIcon,color:"#c0c4cc"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.onClickIcon("prefix")}}}):e._e(),"textarea"===e.type?a("v-uni-textarea",{staticClass:"uni-easyinput__content-textarea",class:{"input-padding":e.inputBorder},attrs:{name:e.name,value:e.val,placeholder:e.placeholder,placeholderStyle:e.placeholderStyle,disabled:e.disabled,maxlength:e.inputMaxlength,focus:e.focused,autoHeight:e.autoHeight},on:{input:function(t){arguments[0]=t=e.$handleEvent(t),e.onInput.apply(void 0,arguments)},blur:function(t){arguments[0]=t=e.$handleEvent(t),e.onBlur.apply(void 0,arguments)},focus:function(t){arguments[0]=t=e.$handleEvent(t),e.onFocus.apply(void 0,arguments)},confirm:function(t){arguments[0]=t=e.$handleEvent(t),e.onConfirm.apply(void 0,arguments)}}}):a("v-uni-input",{staticClass:"uni-easyinput__content-input",style:{"padding-right":"password"===e.type||e.clearable||e.prefixIcon?"":"10px","padding-left":e.prefixIcon?"":"10px"},attrs:{type:"password"===e.type?"text":e.type,name:e.name,value:e.val,password:!e.showPassword&&"password"===e.type,placeholder:e.placeholder,placeholderStyle:e.placeholderStyle,disabled:e.disabled,maxlength:e.inputMaxlength,focus:e.focused,confirmType:e.confirmType},on:{focus:function(t){arguments[0]=t=e.$handleEvent(t),e.onFocus.apply(void 0,arguments)},blur:function(t){arguments[0]=t=e.$handleEvent(t),e.onBlur.apply(void 0,arguments)},input:function(t){arguments[0]=t=e.$handleEvent(t),e.onInput.apply(void 0,arguments)},confirm:function(t){arguments[0]=t=e.$handleEvent(t),e.onConfirm.apply(void 0,arguments)}}}),"password"===e.type&&e.passwordIcon?[""!=e.val?a("uni-icons",{staticClass:"content-clear-icon",class:{"is-textarea-icon":"textarea"===e.type},attrs:{type:e.showPassword?"eye-slash-filled":"eye-filled",size:18,color:"#c0c4cc"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.onEyes.apply(void 0,arguments)}}}):e._e()]:e.suffixIcon?[e.suffixIcon?a("uni-icons",{staticClass:"content-clear-icon",attrs:{type:e.suffixIcon,color:"#c0c4cc"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.onClickIcon("suffix")}}}):e._e()]:[e.clearable&&e.val&&!e.disabled?a("uni-icons",{staticClass:"content-clear-icon",class:{"is-textarea-icon":"textarea"===e.type},attrs:{type:"clear",size:e.clearSize,color:"#c0c4cc"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.onClear.apply(void 0,arguments)}}}):e._e()],e._t("right")],2)],1)},o=[]},"3ac9":function(e,t,a){"use strict";a.r(t);var n=a("01e7"),r=a("dc11");for(var o in r)"default"!==o&&function(e){a.d(t,e,(function(){return r[e]}))}(o);a("446b");var i,s=a("f0c5"),c=Object(s["a"])(r["default"],n["b"],n["c"],!1,null,"08099e61",null,!1,n["a"],i);t["default"]=c.exports},"446b":function(e,t,a){"use strict";var n=a("bdb2"),r=a.n(n);r.a},"4d8b":function(e,t,a){var n=a("24fb");t=n(!1),t.push([e.i,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.strategy-picker-box[data-v-08099e61]{width:440px;display:flex;align-items:center;height:36px}',""]),e.exports=t},"5dad":function(e,t,a){"use strict";var n=a("b372"),r=a.n(n);r.a},8332:function(e,t,a){"use strict";a.r(t);var n=a("ae64"),r=a.n(n);for(var o in n)"default"!==o&&function(e){a.d(t,e,(function(){return n[e]}))}(o);t["default"]=r.a},ae64:function(e,t,a){"use strict";a("a9e3"),a("ac1f"),a("5319"),a("498a"),a("1e25"),a("eee7"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={name:"uni-easyinput",emits:["click","iconClick","update:modelValue","input","focus","blur","confirm"],model:{prop:"modelValue",event:"update:modelValue"},props:{name:String,value:[Number,String],modelValue:[Number,String],type:{type:String,default:"text"},clearable:{type:Boolean,default:!0},autoHeight:{type:Boolean,default:!1},placeholder:String,placeholderStyle:String,focus:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},maxlength:{type:[Number,String],default:140},confirmType:{type:String,default:"done"},clearSize:{type:[Number,String],default:15},inputBorder:{type:Boolean,default:!0},prefixIcon:{type:String,default:""},suffixIcon:{type:String,default:""},trim:{type:[Boolean,String],default:!0},passwordIcon:{type:Boolean,default:!0},styles:{type:Object,default:function(){return{color:"#333",disableColor:"#eee",borderColor:"#e5e5e5"}}},errorMessage:{type:[String,Boolean],default:""}},data:function(){return{focused:!1,errMsg:"",val:"",showMsg:"",border:!1,isFirstBorder:!1,showClearIcon:!1,showPassword:!1}},computed:{msg:function(){return this.errorMessage||this.errMsg},inputMaxlength:function(){return Number(this.maxlength)}},watch:{value:function(e){this.errMsg&&(this.errMsg=""),this.val=e,this.form&&this.formItem&&!this.is_reset&&(this.is_reset=!1,this.formItem.setValue(e))},modelValue:function(e){this.errMsg&&(this.errMsg=""),this.val=e,this.form&&this.formItem&&!this.is_reset&&(this.is_reset=!1,this.formItem.setValue(e))},focus:function(e){var t=this;this.$nextTick((function(){t.focused=t.focus}))}},created:function(){this.value||(this.val=this.modelValue),this.modelValue||(this.val=this.value),this.form=this.getForm("uniForms"),this.formItem=this.getForm("uniFormsItem"),this.form&&this.formItem&&this.formItem.name&&(this.is_reset||(this.is_reset=!1,this.formItem.setValue(this.val)),this.rename=this.formItem.name,this.form.inputChildrens.push(this))},mounted:function(){var e=this;this.$nextTick((function(){e.focused=e.focus}))},methods:{init:function(){},onClickIcon:function(e){this.$emit("iconClick",e)},getForm:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"uniForms",t=this.$parent,a=t.$options.name;while(a!==e){if(t=t.$parent,!t)return!1;a=t.$options.name}return t},onEyes:function(){this.showPassword=!this.showPassword},onInput:function(e){var t=e.detail.value;this.trim&&("boolean"===typeof this.trim&&this.trim&&(t=this.trimStr(t)),"string"===typeof this.trim&&(t=this.trimStr(t,this.trim))),this.errMsg&&(this.errMsg=""),this.val=t,this.$emit("input",t),this.$emit("update:modelValue",t)},onFocus:function(e){this.$emit("focus",e)},onBlur:function(e){e.detail.value;this.$emit("blur",e)},onConfirm:function(e){this.$emit("confirm",e.detail.value)},onClear:function(e){this.val="",this.$emit("input",""),this.$emit("update:modelValue","")},fieldClick:function(){this.$emit("click")},trimStr:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"both";return"both"===t?e.trim():"left"===t?e.trimLeft():"right"===t?e.trimRight():"start"===t?e.trimStart():"end"===t?e.trimEnd():"all"===t?e.replace(/\s+/g,""):e}}};t.default=n},b372:function(e,t,a){var n=a("0baa");"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var r=a("4f06").default;r("134177bc",n,!0,{sourceMap:!1,shadowMode:!1})},b37b:function(e,t,a){"use strict";(function(e){var n=a("4ea4");a("99af"),a("4160"),a("caad"),a("acd8"),a("2532"),a("159b"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("96cf");var r=n(a("1da1")),o=n(a("1126")),i=e.database(),s=i.command,c={data:function(){return{formData:{data_batch:"",strategy_code:"",strategy_name:"",execute_batch:"",execute_status:"",execute_message:"",execute_time:""},multiArray:[["亚洲","欧洲"],["中国","日本"]],multiIndex:[0,0],strategyIndex:-1,strategyPicker:[],batchIndex:-1,batchPicker:[],executeProcess:0}},onLoad:function(){this.init()},methods:{init:function(){var e=this;return(0,r.default)(regeneratorRuntime.mark((function t(){var a,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={},n=[],r=[],t.next=3,i.collection("stock-strategy-set").get();case 3:return a=t.sent,n=a.result.data,n.forEach((function(t,a){e.strategyPicker.includes(t.code)||e.strategyPicker.push(t.code)})),console.log("setList:",n),console.log("this.strategyPicker:",e.strategyPicker),t.next=10,i.collection("stock-data-now").groupBy("batch").orderBy("batch","desc").get();case 10:a=t.sent,r=a.result.data,r.forEach((function(t,a){e.batchPicker.push(t.batch)})),console.log("batchList:",r);case 14:case"end":return t.stop()}}),t)})))()},strategyPickerChange:function(e){console.log("pickerChange:",e),this.strategyIndex=e.detail.value,this.formData.strategy_code=this.strategyPicker[this.strategyIndex],console.log("this.formData.strategy_code:",this.formData.strategy_code)},batchPickerChange:function(e){this.batchIndex=e.detail.value,this.formData.data_batch=this.batchPicker[this.batchIndex]},submitForm:function(){this.$refs.form.submit()},submit:function(e){var t=this;return(0,r.default)(regeneratorRuntime.mark((function a(){var n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.detail,r=n.value,n.errors,console.log("submit value:",r),a.next=4,t.$batch.getBatchNo("EXEC");case 4:return t.formData.execute_batch=a.sent,t.formData.execute_time=(new Date).format("yyyy-MM-dd hh:mm:ss"),"shadow"==t.formData.strategy_code?t.strategyShadow():"drop"==t.formData.strategy_code&&o.default.strategyDrop2(t.formData.execute_batch,t.formData.execute_time),a.next=9,t.insertStrategyExecute();case 9:case"end":return a.stop()}}),a)})))()},strategyShadow:function(){var e=this;return(0,r.default)(regeneratorRuntime.mark((function t(){var a,n,r,o,c,u,l,d,f;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={},n=0,r=500,o=0,c={},u="",l=[],d=[],t.next=3,i.collection("stock-data-now").where({_id:s.neq(null),batch:e.formData.data_batch}).count();case 3:return a=t.sent,n=a.result.total,o=Math.ceil(n/r),t.next=8,i.collection("stock-data-now").where({batch:e.formData.data_batch}).limit(1).orderBy("_id","asc").get();case 8:a=t.sent,u=a.result.data[0]._id,console.log("totalCount:",n,"totalPage:",o,"lastId:",u),f=0;case 12:if(!(f<o)){t.next=30;break}return console.log("当前分页:",f),t.next=16,e.getDataByPage(f,u,r);case 16:return c=t.sent,l=c.dataList,u=c.lastId,console.log("dataList:",l),t.next=22,e.getStrategyItems(l);case 22:if(d=t.sent,!(d.length>0)){t.next=26;break}return t.next=26,e.insertStrategyResult(d);case 26:e.executeProcess=(1+f)/o*100;case 27:f++,t.next=12;break;case 30:case"end":return t.stop()}}),t)})))()},getDataByPage:function(e,t,a){return(0,r.default)(regeneratorRuntime.mark((function n(){var r,o,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r={},o={},0!=e){n.next=8;break}return n.next=5,i.collection("stock-data-now").where({_id:s.gte(t)}).limit(a).orderBy("_id","asc").get();case 5:r=n.sent,n.next=11;break;case 8:return n.next=10,i.collection("stock-data-now").where({_id:s.gt(t)}).limit(a).orderBy("_id","asc").get();case 10:r=n.sent;case 11:return c=r.result.data.length,o.lastId=r.result.data[c-1]._id,o.dataList=r.result.data,n.abrupt("return",o);case 15:case"end":return n.stop()}}),n)})))()},getStrategyItems:function(e){var t=this;return(0,r.default)(regeneratorRuntime.mark((function a(){var n,r,o,i,s,c,u,l,d,f,p,g;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return l={},f=100,g=[],a.next=4,t.getStrategy();case 4:return l=a.sent,console.log("getStrategyItems strategy:",l),t.getDecimal(parseFloat(l.upper)),t.getDecimal(parseFloat(l.body)),d=t.getDecimal(parseFloat(l.lower)),e.forEach((function(e,a){e.code,e.name,n=t.getDecimal(parseFloat(e.high)),r=t.getDecimal(parseFloat(e.low)),o=t.getDecimal(parseFloat(e.open)),i=t.getDecimal(parseFloat(e.price)),i>=o?(console.log("if"),t.getDecimal(n-i),t.getDecimal(i-o),s=t.getDecimal(o-r),c=t.getDecimal(n-r)):(console.log("else"),t.getDecimal(n-o),t.getDecimal(o-i),s=t.getDecimal(i-r),c=t.getDecimal(n-r)),u=t.getDecimal(s/c),p=t.getDecimal(d/f),u>=p&&g.push(e)})),a.abrupt("return",g);case 11:case"end":return a.stop()}}),a)})))()},getDecimal:function(e){return Math.round(100*e)/100},insertStrategyExecute:function(){var e=this;return(0,r.default)(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={},a.batch=e.formData.execute_batch,a.strategy_code=e.formData.strategy_code,a.execute_time=e.formData.execute_time,t.next=6,i.collection("stock-strategy-execute").add(a);case 6:case"end":return t.stop()}}),t)})))()},insertStrategyResult:function(e){var t=this;return(0,r.default)(regeneratorRuntime.mark((function a(){var n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n={},r=[],{},e.forEach((function(e,a){n={},n.execute_batch=t.formData.execute_batch,n.data_batch=t.formData.data_batch,n.strategy_code=t.formData.strategy_code,n.stock_code=e.code.substr(1,e.code.length),n.stock_name=e.name,n.stock_date=e.date,n.execute_time=t.formData.execute_time,r.push(n)})),a.next=4,i.collection("stock-strategy-result").add(r);case 4:a.sent;case 5:case"end":return a.stop()}}),a)})))()},getStrategy:function(){var e=this;return(0,r.default)(regeneratorRuntime.mark((function t(){var a,n,r,o,s,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={},n=[],c={},t.next=3,i.collection("stock-strategy-set").where({code:e.formData.strategy_code}).orderBy("no","asc").get();case 3:return a=t.sent,n=a.result.data,n.forEach((function(e,t){"upper"==e.field?r=e.value:"body"==e.field?o=e.value:"lower"==e.field&&(s=e.value)})),c.upper=r,c.body=o,c.lower=s,t.abrupt("return",c);case 10:case"end":return t.stop()}}),t)})))()},getDate:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,n=e.getDate();return a=a>9?a:"0"+a,n=n>9?n:"0"+n,"".concat(t).concat(a).concat(n)},navigateTo:function(e,t){var a=this;console.log("navigateTo url:",e),uni.navigateTo({url:e,events:{refreshData:function(){a.loadData(t)}}})}}};t.default=c}).call(this,a("a9ff")["default"])},bdb2:function(e,t,a){var n=a("4d8b");"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var r=a("4f06").default;r("e0cd894e",n,!0,{sourceMap:!1,shadowMode:!1})},dc11:function(e,t,a){"use strict";a.r(t);var n=a("b37b"),r=a.n(n);for(var o in n)"default"!==o&&function(e){a.d(t,e,(function(){return n[e]}))}(o);t["default"]=r.a},eee7:function(e,t,a){"use strict";var n=a("23e7"),r=a("58a8").start,o=a("c8d2"),i=o("trimStart"),s=i?function(){return r(this)}:"".trimStart;n({target:"String",proto:!0,forced:i},{trimStart:s,trimLeft:s})}}]);